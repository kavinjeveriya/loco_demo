pipeline {
    agent any
    environment {
       APP="DEV"
       ENV="DEV"
       NAME="MUKUL"
       GIT_COMMIT= "$GIT_COMMIT"
}

    stages {
        stage('Image Building') {
            steps {
                sh " echo $BRANCH_NAME"
                sh "sudo docker build -t firstimage:$ENV.$GIT_COMMIT ."
            }
        }
        stage('Image push') {
            steps {
                sh "echo image pushed to docker hub"
            }
        }
        stage('Container Deploy') {
            steps {
                sh """
                if sudo docker ps -a | grep $ENV-firstcontainer 
                then
                sudo docker rm -f $ENV-firstcontainer 
                sudo docker run -dit --name $ENV-firstcontainer  -p 7000:7000 firstimage:$ENV.$GIT_COMMIT
                else
                sudo docker run -dit --name $ENV-firstcontainer   -p 7000:7000 firstimage:$ENV.$GIT_COMMIT
                fi
                """
            }
        }
    }
}
